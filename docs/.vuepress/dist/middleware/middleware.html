<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overview | Chinchay Docs</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.ab30e0ca.css" as="style"><link rel="preload" href="/assets/js/app.5cd1b9b8.js" as="script"><link rel="preload" href="/assets/js/2.6e51adde.js" as="script"><link rel="preload" href="/assets/js/29.a5fe147d.js" as="script"><link rel="prefetch" href="/assets/js/10.39beef3b.js"><link rel="prefetch" href="/assets/js/11.ae856a89.js"><link rel="prefetch" href="/assets/js/12.529e49bf.js"><link rel="prefetch" href="/assets/js/13.79fc2a4b.js"><link rel="prefetch" href="/assets/js/14.682f471e.js"><link rel="prefetch" href="/assets/js/15.c051699d.js"><link rel="prefetch" href="/assets/js/16.5d06c274.js"><link rel="prefetch" href="/assets/js/17.2eb614fd.js"><link rel="prefetch" href="/assets/js/18.6954d1f4.js"><link rel="prefetch" href="/assets/js/19.3d4ee0ab.js"><link rel="prefetch" href="/assets/js/20.f1d7d420.js"><link rel="prefetch" href="/assets/js/21.32eb42fb.js"><link rel="prefetch" href="/assets/js/22.64d77698.js"><link rel="prefetch" href="/assets/js/23.a0ca5d76.js"><link rel="prefetch" href="/assets/js/24.947e0aa0.js"><link rel="prefetch" href="/assets/js/25.a01f96ca.js"><link rel="prefetch" href="/assets/js/26.3bc9d711.js"><link rel="prefetch" href="/assets/js/27.56f87a97.js"><link rel="prefetch" href="/assets/js/28.f9d20243.js"><link rel="prefetch" href="/assets/js/3.d4c77e9b.js"><link rel="prefetch" href="/assets/js/30.f9cbe6a2.js"><link rel="prefetch" href="/assets/js/31.7845669c.js"><link rel="prefetch" href="/assets/js/32.7ac80465.js"><link rel="prefetch" href="/assets/js/33.53d4d26e.js"><link rel="prefetch" href="/assets/js/34.b1d81033.js"><link rel="prefetch" href="/assets/js/35.460206bf.js"><link rel="prefetch" href="/assets/js/36.eced912b.js"><link rel="prefetch" href="/assets/js/37.a5e102f5.js"><link rel="prefetch" href="/assets/js/38.02b749d7.js"><link rel="prefetch" href="/assets/js/39.b1521343.js"><link rel="prefetch" href="/assets/js/4.b9c9910a.js"><link rel="prefetch" href="/assets/js/40.a4d17c8c.js"><link rel="prefetch" href="/assets/js/41.b5319ff0.js"><link rel="prefetch" href="/assets/js/5.e662506d.js"><link rel="prefetch" href="/assets/js/6.588c36f9.js"><link rel="prefetch" href="/assets/js/7.da043634.js"><link rel="prefetch" href="/assets/js/8.d303a7f3.js"><link rel="prefetch" href="/assets/js/9.be7486b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ab30e0ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Chinchay Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link router-link-active">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gettingstarted/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/models/" class="nav-link">
  The Model
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link router-link-active">
  Middleware
</a></div><div class="nav-item"><a href="/errorhandler/" class="nav-link">
  Error Handler
</a></div><div class="nav-item"><a href="/collaborate/" class="nav-link">
  Collaborate!
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/middleware/access.html" class="sidebar-link">Access</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/middleware/access.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#configure" class="sidebar-link">Configure</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#isadmin" class="sidebar-link">isAdmin</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#hasaccesstoall" class="sidebar-link">hasAccessToAll</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#accessiblesids" class="sidebar-link">accessiblesIds</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#addaccessibletosearch" class="sidebar-link">addAccessibleToSearch</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#find" class="sidebar-link">find</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#hasaccessto" class="sidebar-link">hasAccessTo</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#generatetoken" class="sidebar-link">generateToken</a></li><li class="sidebar-sub-header"><a href="/middleware/access.html#token-encryption" class="sidebar-link">Token Encryption</a></li></ul></li><li><a href="/middleware/middleware.html" aria-current="page" class="active sidebar-link">Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/middleware/middleware.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#hasaccess" class="sidebar-link">hasAccess</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#configuring-prerouting-and-postrouting" class="sidebar-link">Configuring: prerouting and postrouting</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#automating-with-cli-the-middleware-flag" class="sidebar-link">Automating with CLI: the middleware flag</a></li><li class="sidebar-sub-header"><a href="/middleware/middleware.html#token-encryption" class="sidebar-link">Token Encryption</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>The middleware has one function and one main function: does the user requesting a certain API endpoint has access to it?</p> <p>So how do we set it up?</p> <h2 id="hasaccess"><a href="#hasaccess" class="header-anchor">#</a> hasAccess</h2> <p>Let's look to the API route created with the <code>chinchay new</code> command:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/coffee/find'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    coffeeController<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You just need to add the following:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/coffee/find'</span><span class="token punctuation">,</span> Middleware<span class="token punctuation">.</span>hasAccess<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    coffeeController<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Note you must have imported the Middleware first:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> <span class="token punctuation">{</span> Middleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chinchay'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>So before actually running the controller function, the <code>Middleware.hasAccess</code> will be ran, checking that the Bearer token is present, valid and that the user can access it. Only then the controller function will be ran, otherwise it will reject the connection with a 401 code.</p> <h2 id="configuring-prerouting-and-postrouting"><a href="#configuring-prerouting-and-postrouting" class="header-anchor">#</a> Configuring: prerouting and postrouting</h2> <p>Very important! For it to work, you must define that the app must use the middleware prerouting and the middleware postrouting, as such:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  Middleware<span class="token punctuation">.</span><span class="token function">prerouting</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">var</span> coffee <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/coffee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> coffeeAPI <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/coffeeAPI'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> coffee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> coffeeAPI<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  Middleware<span class="token punctuation">.</span><span class="token function">postrouting</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>The prerouting must be before the <code>app.use(...)</code> and the postrouting must be after the <code>app.use(...)</code>.</p></div> <h2 id="automating-with-cli-the-middleware-flag"><a href="#automating-with-cli-the-middleware-flag" class="header-anchor">#</a> Automating with CLI: the middleware flag</h2> <p>When running the <code>chinchay new</code>, you can pass a <code>--middleware</code> to automatically add the <code>Middleware.hasAccess</code>. You can read more on how to work with it in the <a href="/docs/cli.html#the-middleware-flag">documentation of the middleware flag</a>.</p> <h2 id="token-encryption"><a href="#token-encryption" class="header-anchor">#</a> Token Encryption</h2> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>This is <strong>VERY IMPORTANT</strong>: The token is a jsonwebtoken encrypted by the <a href="https://en.wikipedia.org/wiki/Environment_variable" target="_blank" rel="noopener noreferrer">environment variable<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>JWT_SECRET</code>. You must define your own <code>JWT_SECRET</code> that must be kept confidential. If this variable is not defined, Chinchay will use a default secret, this will make your app prone to cyberattacks.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/middleware/access.html" class="prev">
        Access
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5cd1b9b8.js" defer></script><script src="/assets/js/2.6e51adde.js" defer></script><script src="/assets/js/29.a5fe147d.js" defer></script>
  </body>
</html>
